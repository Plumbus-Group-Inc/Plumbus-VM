// This file is autogenerated.
// Do not modify it manually!

#include <array>
#include <functional>

#include "executor/executor.hpp"
#include "generated/handlers.hpp"

namespace pvm {

{% for type in types +%}
const std::array<std::function<void(Instr)>, e{{ type.mnemonic | upper }}_OP_NUM> {{ type.mnemonic  }}DispatchTable{
  {% for instr in type.instrs %}
  &exec_{{ type.mnemonic }}_{{ instr }},
  {% endfor %}
};
{% endfor %}

{% for type in types +%}
void exec_{{ type.mnemonic | upper }}(Instr instr) {
  auto opID = instr.opID;
  {{ type.mnemonic }}DispatchTable[opID](instr);
}
{% endfor %}

std::array<std::function<void(Instr)>, eOPCODE_NUM> opcodeDispatchTable{
  {% for type in types %}
  &exec_{{ type.mnemonic | upper }},
  {% endfor %}
};

void Executor::exec() {
  auto instr = getInstr();
  opcodeDispatchTable[instr.opType](instr);
}

}
